{highlight_code_loc} = import '@fink/snippet/highlight.fnk'
{stack_trace} = import '@fink/std-lib/stack-trace.fnk'



transform_error = fn {message}, expr, {code, filename}:
  {start: {line, column}} = expr.loc
  type_op = '${expr.type} ${expr.op}'

  error = dict:
    error: "
      ${filename}:${line}:${column}
      ${highlight_code_loc code, expr.loc}

      Unable to transform '${type_op}'.
      "
    expr
    message
    stack: stack_trace transform_error

  error


{fink2js} = import '../../testing/generate.fnk'
{describe, it, expect, to_match_snapshot} = import '@fink/jest/test.fnk'



describe 'gen 2', fn:
  it 'compiles', fn:
    expect
      fink2js '
        {_unfold_} = import "@fink/js-interop/iter.js"
        unfold prev:
          prev + 1
      '
      to_match_snapshot

    expect
      fink2js '
        {_unfold_} = import "@fink/js-interop/iter.js"
        unfold prev=1:
          prev + 1
      '
      to_match_snapshot

    expect
      fink2js '
        {_unfold_} = import "@fink/js-interop/iter.js"
        unfold prev=1, acc=1:
          [prev * accu, accu + 1]
      '
      to_match_snapshot





describe 'unfold', fn:

  it 'compiles with previous', fn:
    expect
      fink2js '
        unfold prev:
          prev + 1
      '
      to_match_snapshot


  it 'compiles with default', fn:
    expect
      fink2js '
        unfold prev=1:
          prev + 1
      '
      to_match_snapshot


  it 'compiles with default and accu', fn:
    expect
      fink2js '
        unfold prev=1, acc=1:
          [prev * accu, accu + 1]
      '
      to_match_snapshot


  it 'compiles without args', fn:
    expect
      fink2js '
        unfold:
          1234
      '
      to_match_snapshot


  it 'compiles with spread', fn:
    expect
      fink2js '
        unfold:
          ...[1, 2, 3]
      '
      to_match_snapshot



